---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Background from '../../components/Background.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const formattedDate = post.data.publishDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Layout title={`${post.data.title} - Faisal Khan`} description={post.data.description}>
  <Background />
  <Header />
  
  <main class="pt-32 pb-20 px-4 sm:px-6 lg:px-8">
    <article class="max-w-3xl mx-auto">
      {/* Header */}
      <header class="mb-12">
        <a
          href="/#blog"
          class="inline-flex items-center text-sm text-light-accent dark:text-dark-accent hover:underline mb-6"
        >
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Back to blog
        </a>
        
        <h1 class="text-4xl sm:text-5xl font-bold mb-4">
          {post.data.title}
        </h1>
        
        <div class="flex items-center gap-4 text-light-textSecondary dark:text-dark-textSecondary">
          <time datetime={post.data.publishDate.toISOString()}>
            {formattedDate}
          </time>
        </div>
        
        {post.data.tags && post.data.tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-6">
            {post.data.tags.map((tag: string) => (
              <span
                class="px-3 py-1 text-sm rounded-lg
                       bg-light-surface dark:bg-dark-surface
                       text-light-textSecondary dark:text-dark-textSecondary
                       border border-light-border dark:border-dark-border"
              >
                {tag}
              </span>
            ))}
          </div>
        )}
      </header>

      {/* Content */}
      <div class="prose prose-lg dark:prose-invert max-w-none
                  prose-headings:text-light-text dark:prose-headings:text-dark-text
                  prose-p:text-light-textSecondary dark:prose-p:text-dark-textSecondary
                  prose-a:text-light-accent dark:prose-a:text-dark-accent
                  prose-code:text-light-accent dark:prose-code:text-dark-accent
                  prose-pre:bg-light-surface dark:prose-pre:bg-dark-surface
                  prose-pre:border prose-pre:border-light-border dark:prose-pre:border-dark-border">
        <Content />
      </div>
    </article>
  </main>
  
  <Footer />
</Layout>
